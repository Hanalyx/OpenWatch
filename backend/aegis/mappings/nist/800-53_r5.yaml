# NIST SP 800-53 Rev. 5 Control Mapping for Aegis
#
# This mapping associates NIST 800-53 security controls with Aegis rules.
# NIST controls are many-to-many: one control may require multiple rules,
# and one rule may satisfy multiple controls.
#
# Control families covered:
#   AC  - Access Control
#   AU  - Audit and Accountability
#   CM  - Configuration Management
#   IA  - Identification and Authentication
#   SC  - System and Communications Protection
#   SI  - System and Information Integrity

id: nist-800-53-r5
framework: nist_800_53
title: "NIST SP 800-53 Rev. 5 Security Controls"
published: 2020-09-23

# No platform constraint - NIST controls are OS-agnostic requirements
# Platform-specific implementation is handled by the rules themselves

controls:
  # ════════════════════════════════════════════════════════════════════════════
  # ACCESS CONTROL (AC)
  # ════════════════════════════════════════════════════════════════════════════

  "AC-2":
    title: "Account Management"
    rules:
      - accounts-no-uid-zero
      - nologin-system-accounts
      - inactive-password-lock
      - root-gid
      - default-group-root

  "AC-2(1)":
    title: "Account Management | Automated System Account Management"
    rules:
      - nologin-system-accounts
      - inactive-password-lock

  "AC-3":
    title: "Access Enforcement"
    rules:
      - selinux-enforcing
      - selinux-policy-targeted
      - fs-permissions-etc-passwd
      - fs-permissions-etc-shadow
      - fs-permissions-etc-group
      - fs-permissions-etc-gshadow
      - sudo-use-pty
      - su-require-wheel

  "AC-3(4)":
    title: "Access Enforcement | Discretionary Access Control"
    rules:
      - fs-permissions-etc-passwd
      - fs-permissions-etc-passwd-backup
      - fs-permissions-etc-shadow
      - fs-permissions-etc-shadow-backup
      - fs-permissions-etc-group
      - fs-permissions-etc-group-backup
      - fs-permissions-etc-gshadow
      - fs-permissions-etc-gshadow-backup
      - no-world-writable-files
      - no-unowned-files
      - no-ungrouped-files
      - sticky-bit-world-writable

  "AC-4":
    title: "Information Flow Enforcement"
    rules:
      - service-enable-firewalld
      - selinux-enforcing
      - sysctl-net-ipv4-conf-all-accept-redirects
      - sysctl-net-ipv4-conf-default-accept-redirects
      - sysctl-net-ipv4-conf-all-send-redirects
      - sysctl-net-ipv4-conf-default-send-redirects

  "AC-6":
    title: "Least Privilege"
    rules:
      - ssh-disable-root-login
      - sudo-use-pty
      - sudo-logfile
      - sudo-timeout
      - su-require-wheel
      - accounts-no-uid-zero
      - root-gid
      - root-path-integrity

  "AC-6(1)":
    title: "Least Privilege | Authorize Access to Security Functions"
    rules:
      - sudo-use-pty
      - sudo-logfile
      - su-require-wheel
      - grub-password

  "AC-6(2)":
    title: "Least Privilege | Non-Privileged Access for Nonsecurity Functions"
    rules:
      - ssh-disable-root-login
      - nologin-system-accounts
      - sudo-use-pty
      - su-require-wheel

  "AC-6(5)":
    title: "Least Privilege | Privileged Accounts"
    rules:
      - ssh-disable-root-login
      - sudo-use-pty
      - sudo-timeout
      - su-require-wheel

  "AC-6(9)":
    title: "Least Privilege | Log Use of Privileged Functions"
    rules:
      - sudo-logfile
      - audit-privileged-commands
      - audit-sudoers-changes

  "AC-6(10)":
    title: "Least Privilege | Prohibit Non-Privileged Users from Executing Privileged Functions"
    rules:
      - sudo-use-pty
      - su-require-wheel
      - audit-suid-files
      - audit-sgid-files

  "AC-7":
    title: "Unsuccessful Logon Attempts"
    rules:
      - pam-faillock-deny
      - pam-faillock-unlock-time
      - pam-faillock-fail-interval
      - pam-faillock-even-deny-root

  "AC-8":
    title: "System Use Notification"
    rules:
      - banner-dod-consent
      - banner-ssh-dod
      - ssh-banner
      - motd-permissions
      - issue-permissions
      - issue-net-permissions

  "AC-10":
    title: "Concurrent Session Control"
    rules:
      - ssh-max-sessions

  "AC-11":
    title: "Device Lock"
    rules:
      - shell-timeout
      - ssh-client-alive-interval
      - ssh-client-alive-count-max

  "AC-11(1)":
    title: "Device Lock | Pattern-Hiding Displays"
    rules:
      - shell-timeout

  "AC-12":
    title: "Session Termination"
    rules:
      - ssh-client-alive-interval
      - ssh-client-alive-count-max
      - shell-timeout

  "AC-17":
    title: "Remote Access"
    rules:
      - ssh-disable-root-login
      - ssh-permit-empty-passwords
      - ssh-hostbased-authentication
      - ssh-ignore-rhosts
      - ssh-use-pam
      - ssh-max-auth-tries
      - ssh-login-grace-time
      - ssh-access-control

  "AC-17(1)":
    title: "Remote Access | Monitoring and Control"
    rules:
      - ssh-log-level
      - audit-login-logout
      - audit-session-initiation

  "AC-17(2)":
    title: "Remote Access | Protection of Confidentiality and Integrity Using Encryption"
    rules:
      - ssh-ciphers-fips
      - ssh-macs-fips
      - ssh-kex-fips
      - ssh-crypto-policy
      - crypto-policy-fips

  "AC-17(4)":
    title: "Remote Access | Privileged Commands and Access"
    rules:
      - ssh-disable-root-login
      - sudo-use-pty
      - sudo-logfile

  "AC-18(1)":
    title: "Wireless Access | Authentication and Encryption"
    rules:
      - kmod-disable-bluetooth

  "AC-19(5)":
    title: "Access Control for Mobile Devices | Full Device or Container-Based Encryption"
    rules:
      - kmod-disable-usb-storage

  # ════════════════════════════════════════════════════════════════════════════
  # AUDIT AND ACCOUNTABILITY (AU)
  # ════════════════════════════════════════════════════════════════════════════

  "AU-2":
    title: "Event Logging"
    rules:
      - auditd-service-enabled
      - audit-login-logout
      - audit-session-initiation
      - audit-privileged-commands
      - audit-permission-changes
      - audit-file-deletion
      - audit-user-group-changes
      - audit-sudoers-changes
      - audit-time-change
      - audit-network-changes
      - audit-kernel-modules
      - audit-mount-operations

  "AU-3":
    title: "Content of Audit Records"
    rules:
      - auditd-service-enabled
      - audit-time-change
      - audit-user-group-changes
      - audit-network-changes

  "AU-3(1)":
    title: "Content of Audit Records | Additional Audit Information"
    rules:
      - audit-chown-changes
      - audit-xattr-changes
      - audit-unsuccessful-access
      - audit-unsuccessful-perm

  "AU-4":
    title: "Audit Log Storage Capacity"
    rules:
      - auditd-space-action
      - auditd-admin-space-action
      - auditd-disk-full-action
      - auditd-disk-error-action

  "AU-5":
    title: "Response to Audit Logging Process Failures"
    rules:
      - auditd-space-action
      - auditd-admin-space-action
      - auditd-disk-full-action
      - auditd-disk-error-action

  "AU-5(1)":
    title: "Response to Audit Logging Process Failures | Storage Capacity Warning"
    rules:
      - auditd-space-action
      - auditd-admin-space-action

  "AU-6":
    title: "Audit Record Review, Analysis, and Reporting"
    rules:
      - journald-storage
      - journald-compress
      - rsyslog-default-permissions

  "AU-8":
    title: "Time Stamps"
    rules:
      - audit-time-change

  "AU-9":
    title: "Protection of Audit Information"
    rules:
      - rsyslog-default-permissions
      - journald-storage

  "AU-9(4)":
    title: "Protection of Audit Information | Access by Subset of Privileged Users"
    rules:
      - rsyslog-default-permissions

  "AU-12":
    title: "Audit Record Generation"
    rules:
      - auditd-service-enabled
      - audit-login-logout
      - audit-session-initiation
      - audit-privileged-commands
      - audit-permission-changes
      - audit-user-group-changes
      - audit-sudoers-changes

  "AU-12(1)":
    title: "Audit Record Generation | System-Wide and Time-Correlated Audit Trail"
    rules:
      - auditd-service-enabled
      - audit-time-change

  "AU-12(3)":
    title: "Audit Record Generation | Changes by Authorized Individuals"
    rules:
      - audit-sudoers-changes
      - audit-permission-changes
      - audit-chown-changes

  # ════════════════════════════════════════════════════════════════════════════
  # CONFIGURATION MANAGEMENT (CM)
  # ════════════════════════════════════════════════════════════════════════════

  "CM-5":
    title: "Access Restrictions for Change"
    rules:
      - grub-password
      - grub-config-permissions
      - grub-user-cfg-permissions
      - sudo-use-pty
      - sudo-logfile
      - audit-sudoers-changes

  "CM-5(1)":
    title: "Access Restrictions for Change | Automated Access Enforcement and Audit Records"
    rules:
      - sudo-logfile
      - audit-sudoers-changes
      - audit-permission-changes

  "CM-6":
    title: "Configuration Settings"
    rules:
      - crypto-policy-fips
      - crypto-policy-no-weak
      - selinux-enforcing
      - selinux-policy-targeted

  "CM-7":
    title: "Least Functionality"
    rules:
      - service-disable-autofs
      - service-disable-avahi-daemon
      - service-disable-cups
      - service-disable-debug-shell
      - service-disable-dhcpd
      - service-disable-httpd
      - service-disable-kdump
      - service-disable-named
      - service-disable-nfs
      - service-disable-rpcbind
      - service-disable-rsync
      - service-disable-samba
      - service-disable-snmpd
      - service-disable-squid
      - service-disable-telnet
      - service-disable-tftp
      - service-disable-vsftpd

  "CM-7(1)":
    title: "Least Functionality | Periodic Review"
    rules:
      - service-disable-autofs
      - service-disable-avahi-daemon
      - service-disable-debug-shell

  "CM-7(2)":
    title: "Least Functionality | Prevent Program Execution"
    rules:
      - mount-tmp-noexec
      - mount-var-tmp-noexec
      - mount-dev-shm-noexec

  "CM-7(4)":
    title: "Least Functionality | Unauthorized Software"
    rules:
      - gpgcheck-enabled
      - repo-gpgcheck-enabled
      - localpkg-gpgcheck-enabled
      - aide-installed

  "CM-7(5)":
    title: "Least Functionality | Authorized Software"
    rules:
      - gpgcheck-enabled
      - repo-gpgcheck-enabled
      - localpkg-gpgcheck-enabled

  "CM-8(3)":
    title: "System Component Inventory | Automated Unauthorized Component Detection"
    rules:
      - aide-installed

  "CM-11":
    title: "User-Installed Software"
    rules:
      - gpgcheck-enabled
      - repo-gpgcheck-enabled
      - localpkg-gpgcheck-enabled
      - sudo-use-pty
      - su-require-wheel

  # ════════════════════════════════════════════════════════════════════════════
  # IDENTIFICATION AND AUTHENTICATION (IA)
  # ════════════════════════════════════════════════════════════════════════════

  "IA-2":
    title: "Identification and Authentication (Organizational Users)"
    rules:
      - ssh-pubkey-authentication
      - ssh-use-pam
      - pam-faillock-deny
      - single-user-auth

  "IA-2(1)":
    title: "Identification and Authentication | Multi-Factor Authentication to Privileged Accounts"
    rules:
      - ssh-pubkey-authentication
      - sudo-use-pty

  "IA-2(5)":
    title: "Identification and Authentication | Individual Authentication with Group Authentication"
    rules:
      - ssh-pubkey-authentication
      - accounts-no-uid-zero

  "IA-2(8)":
    title: "Identification and Authentication | Access to Accounts — Replay Resistant"
    rules:
      - ssh-ciphers-fips
      - ssh-macs-fips

  "IA-2(12)":
    title: "Identification and Authentication | Acceptance of PIV Credentials"
    rules:
      - ssh-pubkey-authentication
      - crypto-policy-fips

  "IA-3":
    title: "Device Identification and Authentication"
    rules:
      - ssh-hostbased-authentication
      - ssh-strict-modes

  "IA-4":
    title: "Identifier Management"
    rules:
      - accounts-no-uid-zero
      - root-gid
      - nologin-system-accounts

  "IA-4(4)":
    title: "Identifier Management | Identify User Status"
    rules:
      - inactive-password-lock
      - nologin-system-accounts

  "IA-5":
    title: "Authenticator Management"
    rules:
      - pam-pwquality-minlen
      - pam-pwquality-dcredit
      - pam-pwquality-ucredit
      - pam-pwquality-lcredit
      - pam-pwquality-ocredit
      - pam-pwquality-difok
      - pam-pwquality-minclass
      - pam-pwquality-maxrepeat
      - pam-pwquality-maxclassrepeat
      - pam-pwquality-dictcheck
      - password-remember
      - login-defs-pass-max-days
      - login-defs-pass-min-days
      - login-defs-pass-warn-age
      - login-defs-encrypt-method

  "IA-5(1)":
    title: "Authenticator Management | Password-Based Authentication"
    rules:
      - pam-pwquality-minlen
      - pam-pwquality-dcredit
      - pam-pwquality-ucredit
      - pam-pwquality-lcredit
      - pam-pwquality-ocredit
      - pam-pwquality-difok
      - pam-pwquality-minclass
      - pam-pwquality-maxrepeat
      - pam-pwquality-dictcheck
      - password-remember
      - login-defs-encrypt-method

  "IA-5(2)":
    title: "Authenticator Management | Public Key-Based Authentication"
    rules:
      - ssh-pubkey-authentication
      - ssh-private-key-permissions
      - ssh-public-key-permissions

  "IA-5(7)":
    title: "Authenticator Management | No Embedded Unencrypted Static Authenticators"
    rules:
      - ssh-permit-empty-passwords

  "IA-6":
    title: "Authentication Feedback"
    rules:
      - pam-faillock-deny
      - pam-faillock-unlock-time

  "IA-7":
    title: "Cryptographic Module Authentication"
    rules:
      - crypto-policy-fips
      - fips-mode-enabled

  "IA-11":
    title: "Re-authentication"
    rules:
      - sudo-timeout
      - shell-timeout
      - ssh-client-alive-interval

  # ════════════════════════════════════════════════════════════════════════════
  # SYSTEM AND COMMUNICATIONS PROTECTION (SC)
  # ════════════════════════════════════════════════════════════════════════════

  "SC-2":
    title: "Separation of System and User Functionality"
    rules:
      - nologin-system-accounts
      - selinux-enforcing

  "SC-4":
    title: "Information in Shared System Resources"
    rules:
      - coredump-restricted
      - coredump-suid-disabled
      - mount-tmp-noexec
      - mount-var-tmp-noexec
      - mount-dev-shm-noexec

  "SC-5":
    title: "Denial-of-Service Protection"
    rules:
      - sysctl-net-ipv4-tcp-syncookies
      - ssh-max-startups
      - ssh-max-sessions

  "SC-7":
    title: "Boundary Protection"
    rules:
      - service-enable-firewalld
      - sysctl-net-ipv4-ip-forward
      - sysctl-net-ipv6-conf-all-forwarding
      - sysctl-net-ipv4-conf-all-send-redirects
      - sysctl-net-ipv4-conf-default-send-redirects

  "SC-7(5)":
    title: "Boundary Protection | Deny by Default — Allow by Exception"
    rules:
      - service-enable-firewalld
      - ssh-access-control

  "SC-8":
    title: "Transmission Confidentiality and Integrity"
    rules:
      - ssh-ciphers-fips
      - ssh-macs-fips
      - ssh-kex-fips
      - crypto-policy-fips
      - ssh-crypto-policy

  "SC-8(1)":
    title: "Transmission Confidentiality and Integrity | Cryptographic Protection"
    rules:
      - ssh-ciphers-fips
      - ssh-macs-fips
      - ssh-kex-fips
      - crypto-policy-fips
      - fips-mode-enabled

  "SC-10":
    title: "Network Disconnect"
    rules:
      - ssh-client-alive-interval
      - ssh-client-alive-count-max
      - shell-timeout

  "SC-12":
    title: "Cryptographic Key Establishment and Management"
    rules:
      - ssh-kex-fips
      - ssh-private-key-permissions
      - ssh-public-key-permissions
      - crypto-policy-fips

  "SC-12(1)":
    title: "Cryptographic Key Establishment and Management | Availability"
    rules:
      - ssh-private-key-permissions
      - ssh-public-key-permissions

  "SC-13":
    title: "Cryptographic Protection"
    rules:
      - fips-mode-enabled
      - crypto-policy-fips
      - crypto-policy-no-weak
      - crypto-policy-disable-sha1-signatures
      - ssh-ciphers-fips
      - ssh-macs-fips
      - ssh-kex-fips
      - login-defs-encrypt-method

  "SC-23":
    title: "Session Authenticity"
    rules:
      - ssh-strict-modes
      - ssh-use-pam
      - ssh-hostbased-authentication

  "SC-28":
    title: "Protection of Information at Rest"
    rules:
      - crypto-policy-fips
      - selinux-enforcing
      - fs-permissions-etc-shadow
      - fs-permissions-etc-gshadow

  "SC-28(1)":
    title: "Protection of Information at Rest | Cryptographic Protection"
    rules:
      - crypto-policy-fips
      - fips-mode-enabled
      - login-defs-encrypt-method

  # ════════════════════════════════════════════════════════════════════════════
  # SYSTEM AND INFORMATION INTEGRITY (SI)
  # ════════════════════════════════════════════════════════════════════════════

  "SI-2":
    title: "Flaw Remediation"
    rules:
      - gpgcheck-enabled
      - repo-gpgcheck-enabled
      - localpkg-gpgcheck-enabled

  "SI-3":
    title: "Malicious Code Protection"
    rules:
      - selinux-enforcing
      - selinux-policy-targeted
      - mount-tmp-noexec
      - mount-var-tmp-noexec
      - mount-dev-shm-noexec

  "SI-4":
    title: "System Monitoring"
    rules:
      - auditd-service-enabled
      - audit-login-logout
      - audit-session-initiation
      - audit-privileged-commands
      - journald-storage
      - rsyslog-default-permissions

  "SI-4(4)":
    title: "System Monitoring | Inbound and Outbound Communications Traffic"
    rules:
      - audit-network-changes
      - service-enable-firewalld

  "SI-4(5)":
    title: "System Monitoring | System-Generated Alerts"
    rules:
      - auditd-space-action
      - auditd-admin-space-action

  "SI-6":
    title: "Security and Privacy Function Verification"
    rules:
      - aide-installed
      - selinux-enforcing

  "SI-7":
    title: "Software, Firmware, and Information Integrity"
    rules:
      - aide-installed
      - gpgcheck-enabled
      - repo-gpgcheck-enabled
      - grub-password
      - grub-config-permissions

  "SI-7(1)":
    title: "Software, Firmware, and Information Integrity | Integrity Checks"
    rules:
      - aide-installed

  "SI-7(7)":
    title: "Software, Firmware, and Information Integrity | Integration of Detection and Response"
    rules:
      - aide-installed
      - auditd-service-enabled

  "SI-10":
    title: "Information Input Validation"
    rules:
      - ssh-permit-user-environment
      - ssh-ignore-rhosts

  "SI-11":
    title: "Error Handling"
    rules:
      - kernel-dmesg-restrict
      - coredump-restricted
      - coredump-suid-disabled

  "SI-16":
    title: "Memory Protection"
    rules:
      - aslr-enabled
      - kernel-yama-ptrace
      - kernel-unprivileged-bpf
      - kernel-perf-restrict
      - kexec-load-disabled
      - user-namespaces-disabled
      - ctrl-alt-del-disabled

# Unimplemented controls that require manual verification or are out of scope
unimplemented:
  "AC-1":
    title: "Policy and Procedures"
    reason: "Organizational policy document, not technical control"
    type: Manual

  "AC-5":
    title: "Separation of Duties"
    reason: "Requires organizational role definitions"
    type: Manual

  "AC-14":
    title: "Permitted Actions Without Identification or Authentication"
    reason: "Requires organizational policy definition"
    type: Manual

  "AC-22":
    title: "Publicly Accessible Content"
    reason: "Application-specific control"
    type: Manual

  "AU-1":
    title: "Policy and Procedures"
    reason: "Organizational policy document, not technical control"
    type: Manual

  "AU-7":
    title: "Audit Record Reduction and Report Generation"
    reason: "Requires SIEM or log analysis tooling"
    type: Manual

  "AU-10":
    title: "Non-Repudiation"
    reason: "Requires application-level implementation"
    type: Manual

  "AU-11":
    title: "Audit Record Retention"
    reason: "Requires organizational retention policy"
    type: Manual

  "CM-1":
    title: "Policy and Procedures"
    reason: "Organizational policy document, not technical control"
    type: Manual

  "CM-2":
    title: "Baseline Configuration"
    reason: "Aegis itself provides baseline enforcement"
    type: N/A

  "CM-3":
    title: "Configuration Change Control"
    reason: "Requires change management process"
    type: Manual

  "CM-4":
    title: "Impact Analyses"
    reason: "Requires organizational change management"
    type: Manual

  "IA-1":
    title: "Policy and Procedures"
    reason: "Organizational policy document, not technical control"
    type: Manual

  "IA-8":
    title: "Identification and Authentication (Non-Organizational Users)"
    reason: "Requires organizational identity federation"
    type: Manual

  "SC-1":
    title: "Policy and Procedures"
    reason: "Organizational policy document, not technical control"
    type: Manual

  "SC-3":
    title: "Security Function Isolation"
    reason: "Covered by SELinux at kernel level"
    type: N/A

  "SI-1":
    title: "Policy and Procedures"
    reason: "Organizational policy document, not technical control"
    type: Manual

  "SI-5":
    title: "Security Alerts, Advisories, and Directives"
    reason: "Requires organizational subscription to security feeds"
    type: Manual
