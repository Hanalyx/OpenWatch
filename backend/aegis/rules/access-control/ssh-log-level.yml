id: ssh-log-level
title: Set SSH log level to VERBOSE
description: >
  The SSH daemon must log authentication events at the VERBOSE level.
  VERBOSE logging records additional details including the public key
  fingerprint used for each login, which is essential for determining
  which key was used when multiple keys are authorized for an account.

rationale: >
  At the default INFO level, sshd does not log which specific key was used
  for public key authentication. An attacker who has compromised one of
  several authorized keys for an account would be indistinguishable in the
  logs. VERBOSE logging records the key fingerprint, enabling forensic
  identification of compromised credentials.

severity: low
category: access-control
tags: [ssh, logging, audit]

references:
  cis:
    rhel10_v1:  { section: "5.1.14", level: "L1", type: "Automated" }
    rhel8_v4:  { section: "5.1.16", level: "L1", type: "Automated" }
    rhel9_v2:  { section: "5.1.15", level: "L1", type: "Automated" }
  stig:
    rhel9_v2r7:
      vuln_id: "V-257982"
      stig_id: "RHEL-09-255030"
      severity: "CAT II"
      cci: ["CCI-000067"]
  nist_800_53: ["AU-3", "AU-12"]

platforms:
  - family: rhel
    min_version: 8

implementations:
  - when: sshd_config_d
    check:
      method: config_value
      path: "/etc/ssh/sshd_config.d"
      key: "LogLevel"
      expected: "VERBOSE"
      scan_pattern: "*.conf"
    remediation:
      mechanism: config_set_dropin
      dir: "/etc/ssh/sshd_config.d"
      file: "00-aegis-log-level.conf"
      key: "LogLevel"
      value: "VERBOSE"
      reload: "sshd"

  - default: true
    check:
      method: config_value
      path: "/etc/ssh/sshd_config"
      key: "LogLevel"
      expected: "VERBOSE"
    remediation:
      mechanism: config_set
      path: "/etc/ssh/sshd_config"
      key: "LogLevel"
      value: "VERBOSE"
      separator: " "
      reload: "sshd"
