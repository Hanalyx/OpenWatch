id: ssh-x11-use-localhost
title: Restrict SSH X11 forwarding to localhost
description: >
  The SSH daemon must bind X11 forwarding to the loopback address only.
  X11UseLocalhost controls whether the forwarded X11 display server binds
  to localhost or to the wildcard address, which determines whether remote
  hosts can connect to the proxy display.

rationale: >
  When X11UseLocalhost is disabled, the X11 proxy display listens on all
  interfaces, allowing any host on the network to connect to the forwarded
  display. An attacker on the same network could intercept keystrokes and
  screen contents or inject input into the forwarded X11 session.

severity: low
category: access-control
tags: [ssh, x11, forwarding]

references:
  stig:
    rhel8_v2r6:
      vuln_id: "V-230556"
      stig_id: "RHEL-08-040341"
      severity: "CAT II"
      cci: ["CCI-000366"]
    rhel9_v2r7:
      vuln_id: "V-258011"
      stig_id: "RHEL-09-255175"
      severity: "CAT II"
      cci: ["CCI-000366"]
  nist_800_53: ["CM-6"]

platforms:
  - family: rhel
    min_version: 8

implementations:
  - when: sshd_config_d
    check:
      method: config_value
      path: "/etc/ssh/sshd_config.d"
      key: "X11UseLocalhost"
      expected: "yes"
      scan_pattern: "*.conf"
    remediation:
      mechanism: config_set_dropin
      dir: "/etc/ssh/sshd_config.d"
      file: "00-aegis-x11-use-localhost.conf"
      key: "X11UseLocalhost"
      value: "yes"
      reload: "sshd"

  - default: true
    check:
      method: config_value
      path: "/etc/ssh/sshd_config"
      key: "X11UseLocalhost"
      expected: "yes"
    remediation:
      mechanism: config_set
      path: "/etc/ssh/sshd_config"
      key: "X11UseLocalhost"
      value: "yes"
      separator: " "
      reload: "sshd"
