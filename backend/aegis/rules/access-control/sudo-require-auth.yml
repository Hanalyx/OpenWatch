id: sudo-require-auth
title: Ensure sudo requires authentication
description: >
  The sudoers configuration should require users to authenticate (provide
  their password) before executing commands with elevated privileges. The
  NOPASSWD and !authenticate options should not be used.
rationale: >
  Requiring authentication for sudo commands provides accountability and
  ensures that elevated privileges are not easily abused. Without password
  requirements, any process running as a user with sudo access can execute
  privileged commands.
severity: high
category: access-control
tags: [sudo, privilege-escalation, authentication]

references:
  cis:
    rhel9_v2:  { section: "5.2.4", level: "L1", type: "Automated" }
  stig:
    rhel9_v2r7:
      vuln_id: "V-258034"
      stig_id: "RHEL-09-432005"
      severity: "CAT II"
  nist_800_53: ["IA-11", "AC-6"]

platforms:
  - family: rhel
    min_version: 8

implementations:
  - default: true
    check:
      method: command
      run: "grep -rE '^[^#]*NOPASSWD|^[^#]*!authenticate' /etc/sudoers /etc/sudoers.d/ 2>/dev/null | grep -v '^#'"
      expected_exit: 1
    remediation:
      mechanism: manual
      # pragma: allowlist secret (this is documentation about sudoers config, not an actual secret)
      instructions: >
        Review /etc/sudoers and files in /etc/sudoers.d/ and remove any
        NOPASSWD or !authenticate options. Use 'visudo' to edit these files
        safely. Example: change 'user ALL=(ALL) NOPASSWD: ALL' to
        'user ALL=(ALL) ALL'.
