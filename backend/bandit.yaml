# Bandit Security Scanner Configuration
# https://bandit.readthedocs.io/en/latest/config.html

# Test profiles - only include tests that are NOT skipped below
tests:
  - B201  # flask_debug_true
  - B302  # marshal (insecure deserialization)
  - B303  # md5/sha1 (weak cryptography)
  - B304  # insecure ciphers
  - B305  # insecure cipher modes
  - B306  # insecure tempfile usage
  - B307  # eval() usage
  - B308  # mark_safe() usage
  - B310  # urllib urlopen (SSRF)
  - B312  # telnetlib (insecure protocol)
  - B313  # xml (external entity injection)
  - B315  # xml.expat (XXE)
  - B316  # xml.sax (XXE)
  - B317  # xml.minidom (XXE)
  - B318  # xml.pulldom (XXE)
  - B319  # xml (lxml XXE)
  - B321  # ftplib (insecure protocol)
  - B323  # unverified SSL context
  - B324  # hashlib.md5/sha1
  - B401  # import_telnetlib
  - B402  # import_ftplib
  - B406  # import_xml_sax
  - B407  # import_xml_expat
  - B408  # import_xml_minidom
  - B409  # import_xml_pulldom
  - B411  # import_xmlrpclib
  - B412  # import_httpoxy
  - B413  # import_pycrypto
  - B501  # request_with_no_cert_validation
  - B502  # ssl_with_bad_version
  - B503  # ssl_with_bad_defaults
  - B504  # ssl_with_no_version
  - B505  # weak_cryptographic_key
  - B506  # yaml_load
  - B602  # shell_injection (subprocess with shell=True)
  - B604  # any_other_function_with_shell_equals_true
  - B605  # start_process_with_a_shell
  - B606  # start_process_with_no_shell
  - B609  # linux_commands_wildcard_injection
  - B610  # django_extra_used
  - B611  # django_rawsql_used
  - B701  # jinja2_autoescape_false
  - B702  # use_of_mako_templates
  - B703  # django_mark_safe

# Exclude paths
exclude_dirs:
  - /tests
  - /test
  - /.venv
  - /venv
  - /env
  - /.env
  - /node_modules
  - /__pycache__
  - /.pytest_cache
  - /.mypy_cache
  - /build
  - /dist

# Skips (specific issues to ignore)
# These are excluded because they are expected patterns in the OpenWatch codebase
skips:
  - B101  # assert_used (we use asserts in tests)
  - B104  # hardcoded_bind_all_interfaces (0.0.0.0 is intentional in Docker)
  - B110  # try_except_pass (sometimes necessary)
  # SSH/Paramiko - OpenWatch requires SSH operations with various policies
  - B601  # paramiko_calls (SSH operations are core functionality)
  - B507  # ssh_no_host_key_verification (configurable host key policy)
  # Subprocess - OpenWatch executes system commands for SCAP scanning
  - B603  # subprocess_without_shell_equals_true (argument lists are safe)
  - B607  # start_process_with_partial_path (trusted PATH)
  - B404  # import_subprocess (subprocess is required for system operations)
  # XML parsing - OpenWatch processes SCAP/XCCDF XML content
  # Note: Code uses secure parsing with resolve_entities=False, no_network=True
  - B320  # lxml.etree.parse (used with secure parser configuration)
  - B314  # xml.etree.ElementTree.parse (trusted SCAP content only)
  - B405  # xml.etree.ElementTree import (standard library)
  - B410  # lxml.etree import (used with defusedxml settings)
  # Random - B311 is used for non-cryptographic purposes (e.g., jitter)
  - B311  # random (non-security uses, secrets module used for crypto)
  # Pickle - Required for Celery task serialization (internal only)
  - B301  # pickle (Celery internal use)
  - B403  # import_pickle (Celery requirement)
  # SQL - B608 flags QueryBuilder patterns which use parameterized queries
  # The QueryBuilder class in utils/query_builder.py always uses parameters
  - B608  # hardcoded_sql_expressions (QueryBuilder is parameterized)

# Severity levels
# LOW, MEDIUM, HIGH
severity:
  - MEDIUM
  - HIGH

# Confidence levels
# LOW, MEDIUM, HIGH
confidence:
  - MEDIUM
  - HIGH

# Output format
# Options: csv, json, txt, html, yaml
format: txt

# Show only issues at specified severity and confidence levels
# If not set, all issues are reported
aggregate: file

# Bandit will exit with return code 1 if any issues are found
# Options: all, high, medium, low
level:
  - MEDIUM
  - HIGH
