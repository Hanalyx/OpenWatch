[tool.flake8]
max-line-length = 120
# E203: whitespace before ':' - conflicts with black's slice formatting
# W503: line break before binary operator - conflicts with black
extend-ignore = "E203,W503"
exclude = ".git,__pycache__,build,dist,.venv,venv,.eggs"
per-file-ignores = """
    __init__.py:F401,E402
    **/tests/*:S101
"""

[tool.black]
line-length = 120
target-version = ['py312']
include = '\.pyi?$'
extend-exclude = '''
/(
  # directories
  \.eggs
  | \.git
  | \.hg
  | \.mypy_cache
  | \.tox
  | \.venv
  | venv
  | _build
  | buck-out
  | build
  | dist
)/
'''

[tool.isort]
profile = "black"
line_length = 120

[tool.mypy]
python_version = "3.12"
# Gradual typing mode - not strict
strict = false
# Core type checking settings
warn_unused_configs = true
ignore_missing_imports = true
# Allow subclassing from untyped base classes (e.g., Pydantic BaseModel, Beanie Document)
disallow_subclassing_any = false
# Allow untyped decorators (e.g., FastAPI @router, Celery @app.task)
disallow_untyped_decorators = false
# Allow calling untyped functions from typed context
disallow_untyped_calls = false
# Don't require type annotations on all functions (gradual typing)
disallow_untyped_defs = false
disallow_incomplete_defs = false
check_untyped_defs = true
# Allow Any return values (common with external libraries)
warn_return_any = false
# Check None handling
strict_optional = true
# Allow implicit Optional (param: str = None instead of param: Optional[str] = None)
no_implicit_optional = false
# Useful warnings
warn_redundant_casts = true
warn_unused_ignores = true
# Allow implicit reexports
implicit_reexport = true
# Disable reporting unreachable code (common with version checks)
warn_unreachable = false

# Third-party library overrides (no stubs available)
[[tool.mypy.overrides]]
module = [
    "fastapi.*",
    "starlette.*",
    "pydantic.*",
    "pydantic_settings.*",
    "sqlalchemy.*",
    "beanie.*",
    "celery.*",
    "uvicorn.*",
    "motor.*",
    "pymongo.*",
    "cryptography.*",
    "passlib.*",
    "jose.*",
    "pyotp.*",
    "aiosmtplib.*",
    "jinja2.*",
    "lxml.*",
    "asyncssh.*",
    "paramiko.*",
    "security.*",
    "redis.*",
    "httpx.*",
    "aiohttp.*",
    "PIL.*",
    "yaml.*",
    "defusedxml.*",
    "prometheus_client.*",
]
ignore_missing_imports = true
