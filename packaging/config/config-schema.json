{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OpenWatch Configuration Schema",
  "description": "Configuration schema for OpenWatch SCAP compliance platform",
  "type": "object",
  "required": ["runtime", "database", "web", "scanning", "security", "logging"],
  "properties": {
    "runtime": {
      "type": "object",
      "description": "Container runtime configuration",
      "required": ["engine"],
      "properties": {
        "engine": {
          "type": "string",
          "enum": ["auto", "docker", "podman"],
          "description": "Container runtime engine"
        },
        "rootless": {
          "type": "boolean",
          "default": false,
          "description": "Use rootless containers"
        },
        "compose_file": {
          "type": "string",
          "description": "Path to compose file"
        },
        "registry": {
          "type": "object",
          "properties": {
            "mirror": {
              "type": "string",
              "format": "uri",
              "description": "Registry mirror URL"
            },
            "auth": {
              "type": "string",
              "description": "Base64 encoded credentials"
            }
          }
        }
      }
    },
    "database": {
      "type": "object",
      "description": "PostgreSQL database configuration",
      "required": ["host", "port", "name", "user"],
      "properties": {
        "host": {
          "type": "string",
          "default": "localhost"
        },
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "default": 5432
        },
        "name": {
          "type": "string",
          "default": "openwatch"
        },
        "user": {
          "type": "string",
          "default": "openwatch"
        },
        "ssl_mode": {
          "type": "string",
          "enum": ["disable", "prefer", "require", "verify-ca", "verify-full"],
          "default": "prefer"
        },
        "pool": {
          "type": "object",
          "properties": {
            "max_connections": {
              "type": "integer",
              "minimum": 1,
              "default": 25
            },
            "min_connections": {
              "type": "integer",
              "minimum": 1,
              "default": 5
            },
            "connection_timeout": {
              "type": "integer",
              "minimum": 1,
              "default": 30
            }
          }
        }
      }
    },
    "redis": {
      "type": "object",
      "description": "Redis cache configuration",
      "properties": {
        "host": {
          "type": "string",
          "default": "localhost"
        },
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "default": 6379
        },
        "database": {
          "type": "integer",
          "minimum": 0,
          "maximum": 15,
          "default": 0
        },
        "sentinel": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "master_name": {
              "type": "string"
            },
            "nodes": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "web": {
      "type": "object",
      "description": "Web interface configuration",
      "required": ["port"],
      "properties": {
        "port": {
          "type": "integer",
          "minimum": 1,
          "maximum": 65535,
          "default": 3001
        },
        "bind_address": {
          "type": "string",
          "default": "0.0.0.0"
        },
        "base_url": {
          "type": "string",
          "format": "uri"
        },
        "ssl": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "cert_path": {
              "type": "string"
            },
            "key_path": {
              "type": "string"
            },
            "min_tls_version": {
              "type": "string",
              "enum": ["1.0", "1.1", "1.2", "1.3"],
              "default": "1.2"
            }
          }
        },
        "cors": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "allowed_origins": {
              "type": "string",
              "default": "*"
            }
          }
        }
      }
    },
    "scanning": {
      "type": "object",
      "description": "SCAP scanning configuration",
      "required": ["concurrent_scans"],
      "properties": {
        "ssh_key_path": {
          "type": "string"
        },
        "concurrent_scans": {
          "type": "integer",
          "minimum": 1,
          "maximum": 100,
          "default": 5
        },
        "scan_timeout": {
          "type": "integer",
          "minimum": 60,
          "default": 300
        },
        "scap_content_dir": {
          "type": "string",
          "default": "/var/lib/openwatch/scap"
        },
        "results_dir": {
          "type": "string",
          "default": "/var/lib/openwatch/results"
        },
        "scanner": {
          "type": "object",
          "properties": {
            "oscap_path": {
              "type": "string",
              "default": "/usr/bin/oscap"
            },
            "enhanced_parsing": {
              "type": "boolean",
              "default": false
            }
          }
        }
      }
    },
    "security": {
      "type": "object",
      "description": "Security configuration",
      "properties": {
        "fips_mode": {
          "type": "boolean",
          "default": false
        },
        "auth": {
          "type": "object",
          "properties": {
            "session_timeout": {
              "type": "integer",
              "minimum": 300,
              "default": 3600
            },
            "max_login_attempts": {
              "type": "integer",
              "minimum": 1,
              "default": 5
            },
            "password_min_length": {
              "type": "integer",
              "minimum": 8,
              "default": 12
            }
          }
        },
        "mfa": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "issuer": {
              "type": "string",
              "default": "OpenWatch"
            }
          }
        },
        "api": {
          "type": "object",
          "properties": {
            "rate_limit": {
              "type": "integer",
              "minimum": 1,
              "default": 60
            },
            "require_api_key": {
              "type": "boolean",
              "default": false
            }
          }
        },
        "audit": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            }
          }
        }
      }
    },
    "logging": {
      "type": "object",
      "description": "Logging configuration",
      "required": ["level"],
      "properties": {
        "level": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"],
          "default": "INFO"
        },
        "file": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "path": {
              "type": "string",
              "default": "/var/log/openwatch/openwatch.log"
            },
            "max_size": {
              "type": "string",
              "pattern": "^[0-9]+(B|KB|MB|GB)$",
              "default": "100MB"
            },
            "max_age": {
              "type": "integer",
              "minimum": 1,
              "default": 30
            }
          }
        }
      }
    }
  }
}